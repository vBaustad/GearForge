(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[994],{63:(e,t,a)=>{"use strict";var s=a(7260);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},1786:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},2056:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},2196:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},2529:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},4830:(e,t,a)=>{"use strict";a.d(t,{m:()=>i});var s=a(5155),r=a(6924);function i(e){let{size:t="normal",className:a=""}=e,{login:i,isLoading:l}=(0,r.A)();return(0,s.jsxs)("button",{onClick:i,disabled:l,className:"blizzard-login-btn ".concat("large"===t?"blizzard-login-btn-lg":""," ").concat(a),children:[(0,s.jsx)("img",{src:"https://wow.zamimg.com/images/zul/icons/for-buttons/bnet-large.png",alt:"",className:"blizzard-logo",draggable:!1}),(0,s.jsx)("span",{children:l?"Connecting...":"Login with Battle.net"})]})}},5103:(e,t,a)=>{Promise.resolve().then(a.bind(a,7229))},5229:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6132:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6147:(e,t,a)=>{"use strict";a.d(t,{B:()=>s,R:()=>r});let s={bedroom:"Bedroom",living_room:"Living Room",kitchen:"Kitchen",garden:"Garden",tavern:"Tavern",throne_room:"Throne Room",workshop:"Workshop",library:"Library",exterior:"Exterior",other:"Other"},r=["bedroom","living_room","kitchen","garden","tavern","throne_room","workshop","library","exterior","other"]},6924:(e,t,a)=>{"use strict";a.d(t,{A:()=>h,O:()=>d});var s=a(5155),r=a(2115),i=a(7481),l=a(8900);let n="2ae28e019b8f4fcc9e8b4df7ca2236ec",o=(0,r.createContext)(null),c="gearforge_session";function d(e){let{children:t}=e,[a,d]=(0,r.useState)(null),[h,m]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{g(!0);let e=localStorage.getItem(c);e&&d(e)},[]);let u=(0,i.IT)(l.FH.auth.getCurrentUser,a?{sessionToken:a}:"skip"),y=(0,i.n_)(l.FH.auth.loginWithBlizzard),x=(0,i.n_)(l.FH.auth.logout),v=!p||null!==a&&void 0===u;(0,r.useEffect)(()=>{p&&a&&null===u&&!v&&(localStorage.removeItem(c),d(null))},[p,a,u,v]);let j=async e=>{m(!0);try{let t=await fetch("/api/auth/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to authenticate")}let{battlenetId:a,battleTag:s}=await t.json(),r=await y({battlenetId:a,battleTag:s,avatarUrl:void 0});localStorage.setItem(c,r.token),d(r.token)}catch(e){throw console.error("OAuth error:",e),e}finally{m(!1)}},f=async()=>{a&&(await x({sessionToken:a}),localStorage.removeItem(c),d(null))};return(0,s.jsx)(o.Provider,{value:{user:u||null,sessionToken:a,isLoading:v||h,isAuthenticated:!!u,login:()=>{if(!n){console.error("NEXT_PUBLIC_BLIZZARD_CLIENT_ID not configured"),alert("Blizzard login is not configured. Please set up OAuth credentials.");return}let e=crypto.randomUUID();sessionStorage.setItem("oauth_state",e);let t=new URLSearchParams({client_id:n,redirect_uri:"http://localhost:3000/auth/callback",response_type:"code",scope:"openid",state:e});window.location.href="".concat("https://oauth.battle.net/authorize","?").concat(t)},logout:f,handleOAuthCallback:j},children:t})}function h(){let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},7229:(e,t,a)=>{"use strict";a.d(t,{UploadPageClient:()=>b});var s=a(5155),r=a(2115),i=a(63),l=a(2619),n=a.n(l),o=a(7481),c=a(8900),d=a(9708),h=a(2529),m=a(1786),p=a(6132),g=a(2056);let u=(0,a(1847).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var y=a(5229),x=a(2196),v=a(6147),j=a(6924),f=a(4830);function b(){let e=(0,i.useRouter)(),{isAuthenticated:t,isLoading:a,sessionToken:l}=(0,j.A)(),[b,k]=(0,r.useState)(""),[w,N]=(0,r.useState)(""),[S,A]=(0,r.useState)("bedroom"),[z,B]=(0,r.useState)(""),[C,T]=(0,r.useState)([]),[I,_]=(0,r.useState)(""),[R,P]=(0,r.useState)([]),[U,F]=(0,r.useState)([]),[L,D]=(0,r.useState)(!1),[E,O]=(0,r.useState)(null),[M,W]=(0,r.useState)(null),H=(0,o.n_)(c.FH.creations.create),q=(0,o.n_)(c.FH.creations.generateUploadUrl),[Y,K]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=setTimeout(()=>{K(z.trim())},500);return()=>clearTimeout(e)},[z]);let Z=(0,o.IT)(c.FH.creations.checkDuplicate,Y.length>50?{importString:Y}:"skip");if(a)return(0,s.jsx)("div",{className:"container page-section",children:(0,s.jsx)("div",{style:{minHeight:"50vh"}})});if(!t)return(0,s.jsx)("div",{className:"container page-section",children:(0,s.jsxs)("div",{className:"placeholder-page",children:[(0,s.jsx)("div",{className:"empty-state-icon",children:(0,s.jsx)(d.A,{size:48})}),(0,s.jsx)("h2",{className:"font-display",style:{marginBottom:"var(--space-md)"},children:"Login Required"}),(0,s.jsx)("p",{className:"text-secondary",style:{marginBottom:"var(--space-xl)"},children:"Connect your Battle.net account to upload and share your housing designs."}),(0,s.jsx)(f.m,{size:"large"})]})});let G=()=>{let e=I.trim().toLowerCase();e&&!C.includes(e)&&C.length<10&&(T([...C,e]),_(""))},J=async t=>{if(t.preventDefault(),O(null),!l)return void O("You must be logged in to upload");if(!b.trim())return void O("Title is required");if(!z.trim())return void O("Import string is required");if(0===R.length)return void O("At least one image is required");D(!0);try{let t=[];for(let e of R){let a=await q({sessionToken:l}),s=await fetch(a,{method:"POST",headers:{"Content-Type":e.type},body:e});if(!s.ok)throw Error("Failed to upload image");let{storageId:r}=await s.json();t.push(r)}let a=await H({sessionToken:l,title:b.trim(),description:w.trim()||void 0,importString:z.trim(),imageIds:t,category:S,tags:C,items:[]});W(a),setTimeout(()=>{e.push("/design/".concat(a))},1500)}catch(e){console.error("Upload error:",e),O(e instanceof Error?e.message:"Failed to upload. Please try again.")}finally{D(!1)}};return M?(0,s.jsx)("div",{className:"container page-section",children:(0,s.jsxs)("div",{className:"placeholder-page",children:[(0,s.jsx)("div",{className:"empty-state-icon",style:{background:"rgba(34, 197, 94, 0.15)"},children:(0,s.jsx)(h.A,{size:48,style:{color:"#22c55e"}})}),(0,s.jsx)("h2",{className:"font-display",style:{marginBottom:"var(--space-md)"},children:"Design Uploaded!"}),(0,s.jsx)("p",{className:"text-secondary",children:"Your design is now live. Redirecting..."})]})}):(0,s.jsxs)("div",{className:"container page-section",children:[(0,s.jsxs)("div",{style:{marginBottom:"var(--space-xl)"},children:[(0,s.jsxs)("h1",{className:"font-display",style:{fontSize:"2rem",marginBottom:"var(--space-sm)"},children:[(0,s.jsx)(m.A,{size:24,style:{marginRight:"var(--space-sm)",verticalAlign:"middle"}}),"Upload Design"]}),(0,s.jsx)("p",{className:"text-secondary",children:"Share your housing creation with the community"})]}),E&&(0,s.jsxs)("div",{className:"card",style:{padding:"var(--space-md)",marginBottom:"var(--space-lg)",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[(0,s.jsx)(p.A,{size:18,style:{color:"#ef4444"}}),(0,s.jsx)("span",{style:{color:"#ef4444"},children:E})]}),Z&&(0,s.jsxs)("div",{className:"card",style:{padding:"var(--space-md)",marginBottom:"var(--space-lg)",background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)",marginBottom:"var(--space-sm)"},children:[(0,s.jsx)(g.A,{size:20,style:{color:"#f59e0b"}}),(0,s.jsx)("span",{style:{color:"#f59e0b",fontWeight:500},children:"This design may already exist"})]}),(0,s.jsxs)(n(),{href:"/design/".concat(Z._id),className:"card",style:{display:"flex",alignItems:"center",gap:"var(--space-md)",padding:"var(--space-sm)",textDecoration:"none"},children:[Z.thumbnailUrl&&(0,s.jsx)("img",{src:Z.thumbnailUrl,alt:Z.title,style:{width:60,height:60,objectFit:"cover",borderRadius:"var(--radius)"}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:500},children:Z.title}),(0,s.jsxs)("div",{className:"text-muted",style:{fontSize:"0.875rem"},children:["by ",Z.creatorName]})]})]})]}),(0,s.jsx)("form",{onSubmit:J,children:(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"var(--space-xl)"},children:[(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"card",style:{padding:"var(--space-lg)"},children:[(0,s.jsx)("h3",{style:{marginBottom:"var(--space-lg)"},children:"Basic Info"}),(0,s.jsxs)("div",{style:{marginBottom:"var(--space-md)"},children:[(0,s.jsxs)("label",{htmlFor:"title",style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:["Title ",(0,s.jsx)("span",{style:{color:"var(--accent)"},children:"*"})]}),(0,s.jsx)("input",{id:"title",type:"text",value:b,onChange:e=>k(e.target.value),placeholder:"e.g., Cozy Tavern Corner",className:"input",maxLength:100,style:{width:"100%"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"var(--space-md)"},children:[(0,s.jsxs)("label",{htmlFor:"category",style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:["Category ",(0,s.jsx)("span",{style:{color:"var(--accent)"},children:"*"})]}),(0,s.jsx)("select",{id:"category",value:S,onChange:e=>A(e.target.value),className:"input",style:{width:"100%"},children:v.R.map(e=>(0,s.jsx)("option",{value:e,children:v.B[e]},e))})]}),(0,s.jsxs)("div",{style:{marginBottom:"var(--space-md)"},children:[(0,s.jsx)("label",{htmlFor:"description",style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:"Description"}),(0,s.jsx)("textarea",{id:"description",value:w,onChange:e=>N(e.target.value),placeholder:"Tell us about your design...",className:"input",rows:3,maxLength:2e3,style:{width:"100%",resize:"vertical"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"var(--space-md)"},children:[(0,s.jsxs)("label",{htmlFor:"importString",style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:["Import String ",(0,s.jsx)("span",{style:{color:"var(--accent)"},children:"*"})]}),(0,s.jsx)("input",{id:"importString",type:"text",value:z,onChange:e=>B(e.target.value),placeholder:"Paste your housing import string here...",className:"input",style:{width:"100%"}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:"Tags"}),(0,s.jsxs)("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[(0,s.jsx)("input",{type:"text",value:I,onChange:e=>_(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),G())},placeholder:"Add a tag...",className:"input",style:{flex:1},maxLength:30}),(0,s.jsx)("button",{type:"button",onClick:G,className:"btn btn-secondary",disabled:!I.trim()||C.length>=10,children:(0,s.jsx)(u,{size:16})})]}),C.length>0&&(0,s.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"var(--space-xs)",marginTop:"var(--space-sm)"},children:C.map(e=>(0,s.jsxs)("span",{className:"badge badge-outline",style:{display:"flex",alignItems:"center",gap:"4px"},children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>{T(C.filter(t=>t!==e))},style:{background:"none",border:"none",padding:0,cursor:"pointer",display:"flex"},children:(0,s.jsx)(y.A,{size:12})})]},e))})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"card",style:{padding:"var(--space-lg)",marginBottom:"var(--space-lg)"},children:[(0,s.jsx)("h3",{style:{marginBottom:"var(--space-md)"},children:"Preview"}),(0,s.jsxs)("div",{className:"card",style:{overflow:"hidden"},children:[U.length>0?(0,s.jsx)("img",{src:U[0],alt:"Design preview",style:{width:"100%",height:200,objectFit:"cover"}}):(0,s.jsxs)("div",{style:{width:"100%",height:200,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"var(--surface-elevated)",color:"var(--foreground-muted)"},children:[(0,s.jsx)(x.A,{size:32}),(0,s.jsx)("span",{style:{marginTop:"var(--space-sm)"},children:"Upload a screenshot"})]}),(0,s.jsxs)("div",{style:{padding:"var(--space-md)"},children:[(0,s.jsx)("h4",{style:{marginBottom:"var(--space-xs)"},children:b||"Your Design Title"}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[(0,s.jsx)("span",{className:"badge",children:v.B[S]}),C.length>0&&(0,s.jsxs)("span",{className:"text-muted",style:{fontSize:"0.875rem"},children:[C.length," tags"]})]})]})]})]}),(0,s.jsxs)("div",{className:"card",style:{padding:"var(--space-lg)",marginBottom:"var(--space-lg)"},children:[(0,s.jsxs)("h3",{style:{marginBottom:"var(--space-md)"},children:["Screenshots ",(0,s.jsx)("span",{style:{color:"var(--accent)"},children:"*"})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"var(--space-sm)"},children:[U.map((e,t)=>(0,s.jsxs)("div",{style:{position:"relative"},children:[(0,s.jsx)("img",{src:e,alt:"Preview ".concat(t+1),style:{width:"100%",height:80,objectFit:"cover",borderRadius:"var(--radius)"}}),(0,s.jsx)("button",{type:"button",onClick:()=>(e=>{let t=R.filter((t,a)=>a!==e),a=U.filter((t,a)=>a!==e);P(t),F(a)})(t),style:{position:"absolute",top:4,right:4,width:20,height:20,borderRadius:"50%",background:"rgba(0,0,0,0.7)",border:"none",color:"white",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)(y.A,{size:12})}),0===t&&(0,s.jsx)("span",{style:{position:"absolute",bottom:4,left:4,fontSize:"0.625rem",background:"var(--accent)",color:"white",padding:"2px 6px",borderRadius:"var(--radius-sm)"},children:"Thumbnail"})]},t)),R.length<5&&(0,s.jsxs)("label",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:80,border:"2px dashed var(--border)",borderRadius:"var(--radius)",cursor:"pointer",color:"var(--foreground-muted)"},children:[(0,s.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{let t=Array.from(e.target.files||[]);if(t.length+R.length>5)return void O("Maximum 5 images allowed");let a=[...R,...t].slice(0,5);P(a),F(a.map(e=>URL.createObjectURL(e))),O(null)},style:{display:"none"}}),(0,s.jsx)(u,{size:20}),(0,s.jsxs)("span",{style:{fontSize:"0.75rem"},children:[R.length,"/5"]})]})]})]}),(0,s.jsx)("button",{type:"submit",className:"btn btn-primary btn-lg",style:{width:"100%",justifyContent:"center"},disabled:L,children:L?"Uploading...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.A,{size:18})," Upload Design"]})})]})]})})]})}},8900:(e,t,a)=>{"use strict";a.d(t,{FH:()=>r});var s=a(5991);let r=s.dp;(0,s.Op)()},9708:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])}},e=>{e.O(0,[619,237,441,255,358],()=>e(e.s=5103)),_N_E=e.O()}]);