(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[769],{63:(e,t,a)=>{"use strict";var r=a(7260);a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},2348:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(1847).A)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},6924:(e,t,a)=>{"use strict";a.d(t,{A:()=>d,O:()=>u});var r=a(5155),o=a(2115),s=a(7481),n=a(8900);let l="2ae28e019b8f4fcc9e8b4df7ca2236ec",i=(0,o.createContext)(null),c="gearforge_session";function u(e){let{children:t}=e,[a,u]=(0,o.useState)(null),[d,h]=(0,o.useState)(!1),[m,g]=(0,o.useState)(!1);(0,o.useEffect)(()=>{g(!0);let e=localStorage.getItem(c);e&&u(e)},[]);let p=(0,s.IT)(n.FH.auth.getCurrentUser,a?{sessionToken:a}:"skip"),v=(0,s.n_)(n.FH.auth.loginWithBlizzard),y=(0,s.n_)(n.FH.auth.logout),f=!m||null!==a&&void 0===p;(0,o.useEffect)(()=>{m&&a&&null===p&&!f&&(localStorage.removeItem(c),u(null))},[m,a,p,f]);let k=async e=>{h(!0);try{let t=await fetch("/api/auth/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to authenticate")}let{battlenetId:a,battleTag:r}=await t.json(),o=await v({battlenetId:a,battleTag:r,avatarUrl:void 0});localStorage.setItem(c,o.token),u(o.token)}catch(e){throw console.error("OAuth error:",e),e}finally{h(!1)}},w=async()=>{a&&(await y({sessionToken:a}),localStorage.removeItem(c),u(null))};return(0,r.jsx)(i.Provider,{value:{user:p||null,sessionToken:a,isLoading:f||d,isAuthenticated:!!p,login:()=>{if(!l){console.error("NEXT_PUBLIC_BLIZZARD_CLIENT_ID not configured"),alert("Blizzard login is not configured. Please set up OAuth credentials.");return}let e=crypto.randomUUID();sessionStorage.setItem("oauth_state",e);let t=new URLSearchParams({client_id:l,redirect_uri:"http://localhost:3000/auth/callback",response_type:"code",scope:"openid",state:e});window.location.href="".concat("https://oauth.battle.net/authorize","?").concat(t)},logout:w,handleOAuthCallback:k},children:t})}function d(){let e=(0,o.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},8724:(e,t,a)=>{Promise.resolve().then(a.bind(a,9358))},8900:(e,t,a)=>{"use strict";a.d(t,{FH:()=>o});var r=a(5991);let o=r.dp;(0,r.Op)()},9358:(e,t,a)=>{"use strict";a.d(t,{AuthCallbackClient:()=>i});var r=a(5155),o=a(2115),s=a(63),n=a(6924),l=a(2348);function i(){let e=(0,s.useSearchParams)(),t=(0,s.useRouter)(),{handleOAuthCallback:a}=(0,n.A)(),[i,c]=(0,o.useState)(null);return((0,o.useEffect)(()=>{let r=null==e?void 0:e.get("code");return(null==e?void 0:e.get("state"))!==sessionStorage.getItem("oauth_state")?void c("Invalid state parameter. Please try logging in again."):r?void(sessionStorage.removeItem("oauth_state"),a(r).then(()=>{t.push("/")}).catch(e=>{console.error("OAuth callback error:",e),c("Failed to complete login. Please try again.")})):void c("No authorization code received. Please try logging in again.")},[e,a,t]),i)?(0,r.jsx)("div",{className:"container page-section",children:(0,r.jsxs)("div",{className:"placeholder-page",children:[(0,r.jsx)("h2",{className:"font-display",style:{color:"var(--accent)",marginBottom:"var(--space-md)"},children:"Login Error"}),(0,r.jsx)("p",{className:"text-secondary",style:{marginBottom:"var(--space-xl)"},children:i}),(0,r.jsx)("button",{onClick:()=>t.push("/"),className:"btn btn-primary",children:"Return Home"})]})}):(0,r.jsx)("div",{className:"container page-section",children:(0,r.jsxs)("div",{className:"placeholder-page",children:[(0,r.jsx)(l.A,{size:32,className:"animate-spin",style:{color:"var(--accent)",marginBottom:"var(--space-lg)"}}),(0,r.jsx)("h2",{className:"font-display",style:{marginBottom:"var(--space-md)"},children:"Completing Login..."}),(0,r.jsx)("p",{className:"text-secondary",children:"Please wait while we verify your Battle.net account."})]})})}}},e=>{e.O(0,[237,441,255,358],()=>e(e.s=8724)),_N_E=e.O()}]);