(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[862],{63:(e,t,a)=>{"use strict";var s=a(7260);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},2196:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},2529:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5229:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5626:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},6046:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},6132:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6147:(e,t,a)=>{"use strict";a.d(t,{B:()=>s,R:()=>r});let s={bedroom:"Bedroom",living_room:"Living Room",kitchen:"Kitchen",garden:"Garden",tavern:"Tavern",throne_room:"Throne Room",workshop:"Workshop",library:"Library",exterior:"Exterior",other:"Other"},r=["bedroom","living_room","kitchen","garden","tavern","throne_room","workshop","library","exterior","other"]},6924:(e,t,a)=>{"use strict";a.d(t,{A:()=>m,O:()=>d});var s=a(5155),r=a(2115),i=a(7481),l=a(8900);let n="2ae28e019b8f4fcc9e8b4df7ca2236ec",o=(0,r.createContext)(null),c="gearforge_session";function d(e){let{children:t}=e,[a,d]=(0,r.useState)(null),[m,h]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{g(!0);let e=localStorage.getItem(c);e&&d(e)},[]);let u=(0,i.IT)(l.FH.auth.getCurrentUser,a?{sessionToken:a}:"skip"),y=(0,i.n_)(l.FH.auth.loginWithBlizzard),x=(0,i.n_)(l.FH.auth.logout),v=!p||null!==a&&void 0===u;(0,r.useEffect)(()=>{p&&a&&null===u&&!v&&(localStorage.removeItem(c),d(null))},[p,a,u,v]);let f=async e=>{h(!0);try{let t=await fetch("/api/auth/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to authenticate")}let{battlenetId:a,battleTag:s}=await t.json(),r=await y({battlenetId:a,battleTag:s,avatarUrl:void 0});localStorage.setItem(c,r.token),d(r.token)}catch(e){throw console.error("OAuth error:",e),e}finally{h(!1)}},j=async()=>{a&&(await x({sessionToken:a}),localStorage.removeItem(c),d(null))};return(0,s.jsx)(o.Provider,{value:{user:u||null,sessionToken:a,isLoading:v||m,isAuthenticated:!!u,login:()=>{if(!n){console.error("NEXT_PUBLIC_BLIZZARD_CLIENT_ID not configured"),alert("Blizzard login is not configured. Please set up OAuth credentials.");return}let e=crypto.randomUUID();sessionStorage.setItem("oauth_state",e);let t=new URLSearchParams({client_id:n,redirect_uri:"http://localhost:3000/auth/callback",response_type:"code",scope:"openid",state:e});window.location.href="".concat("https://oauth.battle.net/authorize","?").concat(t)},logout:j,handleOAuthCallback:f},children:t})}function m(){let e=(0,r.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},7413:(e,t,a)=>{Promise.resolve().then(a.bind(a,9581))},8900:(e,t,a)=>{"use strict";a.d(t,{FH:()=>r});var s=a(5991);let r=s.dp;(0,s.Op)()},9581:(e,t,a)=>{"use strict";a.d(t,{EditDesignPageClient:()=>f});var s=a(5155),r=a(2115),i=a(63),l=a(2619),n=a.n(l),o=a(7481),c=a(8900),d=a(6924),m=a(6147),h=a(9708),p=a(2529),g=a(5626),u=a(6132),y=a(5229),x=a(6046),v=a(2196);function f(e){let{id:t}=e,a=(0,i.useRouter)(),{user:l,isLoading:f,sessionToken:j}=(0,d.A)(),b=(0,o.IT)(c.FH.creations.getById,{id:t}),k=(0,o.n_)(c.FH.creations.update),[N,w]=(0,r.useState)(""),[B,A]=(0,r.useState)(""),[S,z]=(0,r.useState)("other"),[C,_]=(0,r.useState)([]),[I,T]=(0,r.useState)(""),[P,R]=(0,r.useState)(!1),[D,E]=(0,r.useState)(null),[L,F]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{b&&(w(b.title),A(b.description||""),z(b.category),_(b.tags||[]))},[b]),f||void 0===b)return(0,s.jsx)("div",{className:"container page-section",children:(0,s.jsx)("div",{style:{minHeight:"50vh"}})});if(null===b)return(0,s.jsx)("div",{className:"container page-section",children:(0,s.jsxs)("div",{className:"placeholder-page",children:[(0,s.jsx)("h2",{className:"font-display",style:{marginBottom:"var(--space-md)"},children:"Design Not Found"}),(0,s.jsx)("p",{className:"text-secondary",style:{marginBottom:"var(--space-xl)"},children:"This design may have been removed or doesn't exist."}),(0,s.jsx)(n(),{href:"/browse",className:"btn btn-primary",children:"Browse Designs"})]})});if(!l)return(0,s.jsx)("div",{className:"container page-section",children:(0,s.jsxs)("div",{className:"placeholder-page",children:[(0,s.jsx)("div",{className:"empty-state-icon",children:(0,s.jsx)(h.A,{size:48})}),(0,s.jsx)("h2",{className:"font-display",style:{marginBottom:"var(--space-md)"},children:"Login Required"}),(0,s.jsx)("p",{className:"text-secondary",style:{marginBottom:"var(--space-xl)"},children:"Please log in to edit designs."}),(0,s.jsx)(n(),{href:"/",className:"btn btn-primary",children:"Return Home"})]})});if(b.creatorId!==l.id&&"admin"!==l.role&&"moderator"!==l.role)return(0,s.jsx)("div",{className:"container page-section",children:(0,s.jsxs)("div",{className:"placeholder-page",children:[(0,s.jsx)("div",{className:"empty-state-icon",children:(0,s.jsx)(h.A,{size:48})}),(0,s.jsx)("h2",{className:"font-display",style:{marginBottom:"var(--space-md)"},children:"Access Denied"}),(0,s.jsx)("p",{className:"text-secondary",style:{marginBottom:"var(--space-xl)"},children:"You can only edit your own designs."}),(0,s.jsx)(n(),{href:"/design/".concat(t),className:"btn btn-primary",children:"View Design"})]})});let H=()=>{let e=I.trim().toLowerCase();e&&!C.includes(e)&&C.length<5&&(_([...C,e]),T(""))},U=async e=>{if(e.preventDefault(),!j)return void E("Session expired. Please log in again.");if(!N.trim())return void E("Title is required");R(!0),E(null);try{await k({id:t,sessionToken:j,title:N.trim(),description:B.trim()||void 0,category:S,tags:C}),F(!0),setTimeout(()=>{a.push("/design/".concat(t))},1500)}catch(e){console.error("Failed to update design:",e),E(e instanceof Error?e.message:"Failed to save changes")}finally{R(!1)}};return L?(0,s.jsx)("div",{className:"container page-section",children:(0,s.jsxs)("div",{className:"placeholder-page",children:[(0,s.jsx)("div",{className:"empty-state-icon",style:{background:"rgba(34, 197, 94, 0.15)"},children:(0,s.jsx)(p.A,{size:48,style:{color:"#22c55e"}})}),(0,s.jsx)("h2",{className:"font-display",style:{marginBottom:"var(--space-md)"},children:"Changes Saved!"}),(0,s.jsx)("p",{className:"text-secondary",children:"Redirecting to your design..."})]})}):(0,s.jsxs)("div",{className:"container page-section",children:[(0,s.jsxs)(n(),{href:"/design/".concat(t),className:"design-back-link",children:[(0,s.jsx)(g.A,{size:18}),"Back to Design"]}),(0,s.jsxs)("div",{style:{marginBottom:"var(--space-xl)"},children:[(0,s.jsx)("h1",{className:"font-display",style:{fontSize:"2rem",marginBottom:"var(--space-sm)"},children:"Edit Design"}),(0,s.jsx)("p",{className:"text-secondary",children:"Update your housing design details"})]}),D&&(0,s.jsxs)("div",{className:"card",style:{padding:"var(--space-md)",marginBottom:"var(--space-lg)",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",display:"flex",alignItems:"center",gap:"var(--space-sm)"},children:[(0,s.jsx)(u.A,{size:18,style:{color:"#ef4444"}}),(0,s.jsx)("span",{style:{color:"#ef4444"},children:D})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 300px",gap:"var(--space-xl)"},children:[(0,s.jsx)("form",{onSubmit:U,children:(0,s.jsxs)("div",{className:"card",style:{padding:"var(--space-lg)"},children:[(0,s.jsxs)("div",{style:{marginBottom:"var(--space-lg)"},children:[(0,s.jsxs)("label",{htmlFor:"title",style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:["Title ",(0,s.jsx)("span",{style:{color:"var(--accent)"},children:"*"})]}),(0,s.jsx)("input",{id:"title",type:"text",value:N,onChange:e=>w(e.target.value),placeholder:"e.g., Cozy Tavern Corner",className:"input",maxLength:100,style:{width:"100%"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"var(--space-lg)"},children:[(0,s.jsx)("label",{htmlFor:"description",style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:"Description"}),(0,s.jsx)("textarea",{id:"description",value:B,onChange:e=>A(e.target.value),placeholder:"Describe your design...",className:"input",rows:4,maxLength:1e3,style:{width:"100%",resize:"vertical"}})]}),(0,s.jsxs)("div",{style:{marginBottom:"var(--space-lg)"},children:[(0,s.jsxs)("label",{htmlFor:"category",style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:["Category ",(0,s.jsx)("span",{style:{color:"var(--accent)"},children:"*"})]}),(0,s.jsx)("select",{id:"category",value:S,onChange:e=>z(e.target.value),className:"input",style:{width:"100%"},children:m.R.map(e=>(0,s.jsx)("option",{value:e,children:m.B[e]},e))})]}),(0,s.jsxs)("div",{style:{marginBottom:"var(--space-lg)"},children:[(0,s.jsx)("label",{style:{display:"block",marginBottom:"var(--space-xs)",fontWeight:500},children:"Tags (up to 5)"}),(0,s.jsxs)("div",{style:{display:"flex",gap:"var(--space-sm)",marginBottom:"var(--space-sm)"},children:[(0,s.jsx)("input",{type:"text",value:I,onChange:e=>T(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),H())},placeholder:"Add a tag...",className:"input",style:{flex:1},maxLength:20}),(0,s.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:H,disabled:C.length>=5,children:"Add"})]}),C.length>0&&(0,s.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"var(--space-xs)"},children:C.map(e=>(0,s.jsxs)("span",{className:"badge badge-outline",style:{display:"flex",alignItems:"center",gap:"var(--space-xs)"},children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>{_(C.filter(t=>t!==e))},style:{background:"none",border:"none",cursor:"pointer",padding:0,display:"flex"},children:(0,s.jsx)(y.A,{size:12})})]},e))})]}),(0,s.jsx)("p",{className:"text-muted",style:{fontSize:"0.875rem",marginBottom:"var(--space-lg)"},children:"Note: The import string and images cannot be changed. If you need to update these, please delete this design and create a new one."}),(0,s.jsxs)("button",{type:"submit",className:"btn btn-primary",disabled:P,style:{display:"flex",alignItems:"center",gap:"var(--space-xs)"},children:[(0,s.jsx)(x.A,{size:18}),P?"Saving...":"Save Changes"]})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"card",style:{padding:"var(--space-lg)"},children:[(0,s.jsx)("h3",{style:{marginBottom:"var(--space-md)"},children:"Preview"}),b.imageUrls&&b.imageUrls.length>0?(0,s.jsx)("div",{style:{aspectRatio:"16/9",borderRadius:"var(--radius)",overflow:"hidden",marginBottom:"var(--space-md)"},children:(0,s.jsx)("img",{src:b.imageUrls[0],alt:N,style:{width:"100%",height:"100%",objectFit:"cover"}})}):(0,s.jsx)("div",{style:{aspectRatio:"16/9",borderRadius:"var(--radius)",background:"var(--surface-elevated)",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"var(--space-md)"},children:(0,s.jsx)(v.A,{size:32,className:"text-muted"})}),(0,s.jsx)("span",{className:"badge",style:{marginBottom:"var(--space-sm)"},children:m.B[S]}),(0,s.jsx)("h4",{style:{marginBottom:"var(--space-xs)"},children:N||"Untitled"}),(0,s.jsxs)("p",{className:"text-muted",style:{fontSize:"0.875rem"},children:["by ",l.battleTag.split("#")[0]]}),C.length>0&&(0,s.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"var(--space-xs)",marginTop:"var(--space-md)"},children:C.map(e=>(0,s.jsx)("span",{className:"badge badge-outline",style:{fontSize:"0.75rem"},children:e},e))})]})})]})]})}},9708:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(1847).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])}},e=>{e.O(0,[619,237,441,255,358],()=>e(e.s=7413)),_N_E=e.O()}]);